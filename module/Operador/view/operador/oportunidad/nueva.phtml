<?php
//LLamaremos a la session
use Zend\Session\Container;
$sid = new Container('base');
$usuario = $sid->offsetGet('usuario');
?>
<div class="row">
					<div class="col-md-12">
						<!-- BEGIN SAMPLE FORM PORTLET-->
						<div class="portlet light">
							<div class="portlet-title">
								<div class="caption font-green-haze">
									<i class="icon-star font-green-haze"></i>
									<span class="caption-subject bold uppercase"> Ingreso de Oportunidad</span>
								</div>
								<div class="actions">
									<a class="btn btn-circle btn-icon-only red" onclick="reset()">
									<i class="icon-trash"></i>
									</a>
									<a class="btn btn-circle btn-icon-only btn-default fullscreen" href="javascript:;" data-original-title="" title="">
									</a>
								</div>
							</div>
							<div class="portlet-body form">                            
								<form id="form_prospecto" action="<?php echo $this->basePath()?>/operador/oportunidad/actualizardatos" role="form" class="form-horizontal">
									<div class="form-body">
                                        <div class="form-group form-md-line-input">
									       <div id="alertok"></div>
                                            <div id="alertnok"></div>
										</div>                                    
                                    
                                                                        
										<div class="form-group form-md-line-input">
											<label class="col-md-2 control-label" for="nueva_rut">Rut</label>
											<div class="col-md-2">
												<input type="text" class="form-control" id="nueva_rut" name="rut">
												<div class="form-control-focus">
												</div>
                                                <span class="help-block">Sin puntos ni DV</span>
											</div>
                                            <span class="input-group-btn btn-right">
												            <a id="busca_rut" class="btn green-haze" ><i class="fa fa-search"></i></a>
			                                </span> 
										</div>
            <div id="div_form" class="hide">
										<div class="form-group form-md-line-input">
											<label class="col-md-2 control-label" for="nueva_nombre">Nombre</label>
											<div class="col-md-5">
												<input type="text" class="form-control" id="nueva_nombre" name="NOMBRES">
												<div class="form-control-focus">
												</div>												
											</div>
										</div>
										<div class="form-group form-md-line-input has-success">
											<label class="col-md-2 control-label" for="nueva_apellidop">Apellido Paterno</label>
											<div class="col-md-5">
												<input type="text" class="form-control" id="nueva_apellidop" name="AP_PATERNO">
												<div class="form-control-focus">
												</div>
											</div>
										</div>
										<div class="form-group form-md-line-input has-warning">
											<label class="col-md-2 control-label" for="nueva_apellidom">Apellido Materno</label>
											<div class="col-md-5">
												<input type="text" class="form-control" id="nueva_apellidom" name="AP_MATERNO">
												<div class="form-control-focus">
												</div>
                                                
											</div>
										</div>
										<div class="form-group form-md-line-input has-error">
											<label class="col-md-2 control-label" for="nueva_estado">Estado</label>
											<div class="col-md-2">
												<input type="text" class="form-control" id="nueva_estado" name="ESTADO" disabled>
												<div class="form-control-focus">
												</div>
											</div>
										</div>
										<!--div class="form-group form-md-line-input">
											<label class="col-md-2 control-label" for="form_control_1">Dropdown Input</label>
											<div class="col-md-10">
												<select class="form-control" id="form_control_1">
													<option value=""></option>
													<option value="">Option 1</option>
													<option value="">Option 2</option>
													<option value="">Option 3</option>
													<option value="">Option 4</option>
												</select>
												<div class="form-control-focus">
												</div>
											</div>
										</div-->
										<!--div class="form-group form-md-line-input has-success">
											<label class="col-md-2 control-label" for="form_control_1">Textarea</label>
											<div class="col-md-10">
												<textarea class="form-control" rows="3" placeholder="Enter more text"></textarea>
												<div class="form-control-focus">
												</div>
											</div>
										</div-->
                                        <div class="form-group form-md-line-input has-error">
											<label class="col-md-2 control-label" for="nueva_correo">Correo</label>
											<div class="col-md-5">                                            
												<input type="text" class="form-control" id="nueva_correo" name="CORREO" >
												<div class="form-control-focus">
												</div>
											</div>
										</div>
                                        <div class="form-group form-md-line-input has-error">
											<label class="col-md-2 control-label" for="nueva_tel">Tel&eacute;fono</label>
											<div class="col-md-5">
												<input type="text" class="form-control" id="nueva_tel" name="TELEFONO">
												<div class="form-control-focus">
												</div>
											</div>
										</div>
                                        <div class="form-group form-md-line-input has-error">
											<label class="col-md-2 control-label" for="nueva_celu">Celular</label>
											<div class="col-md-5">
												<input type="text" class="form-control" id="nueva_celu" name="CELULAR">
												<div class="form-control-focus">
												</div>
											</div>
										</div>
                                        <div class="form-group form-md-line-input has-error">
											<label class="col-md-2 control-label" for="nueva_direc">Direcci&oacute;n</label>
											<div class="col-md-5">
												<input type="text" class="form-control" id="nueva_direc" name="DIRECCION" >
												<div class="form-control-focus">
												</div>
											</div>
										</div>
                                        <div class="form-group form-md-line-input has-error">
											<label class="col-md-2 control-label" for="nueva_establec">Emp./Establecimiento</label>
											<div class="col-md-5">
												<input type="text" class="form-control" id="nueva_establec" name="EMPRESA_ESTABLEC" >
                                                <input type="hidden" name="USERNAME_ACTUALIZACION" value="<?php echo $usuario;?>" >
												<div class="form-control-focus">
												</div>
											</div>
										</div>									
									
                                    <table class="table table-hover">
									<thead>
									<tr>
										<th>
											 #
										</th>
										<th>
											 Correo
										</th>
										<th>
											 Tel&eacute;fono
										</th>
										<th>
											 Celular
										</th>
                                        <th>
										     Empresa/Establec. 
										</th>
                                        <th>
										     Direcci&oacute;n 
										</th>
                                        <th>
										    Usuario 
										</th>                                         
                                        <th>
										    Fecha 
										</th>
									</tr>
									</thead>
									<tbody id="nueva_bodytable">

									</tbody>
									</table>
									<div class="form-actions">
										<div class="row">
											<div class="col-md-offset-2 col-md-10">
												<button type="button" class="btn default"><i class="fa fa-thumbs-down"></i> &nbsp; No le interesa</button>
												<button type="submit" class="btn blue"><i class="fa fa-save"></i> &nbsp; Actualizar Datos</button>
                                                <a onclick="mostrarpaso2()" class="btn green">Paso 2 - Asignar Campa&ntilde;a/Sede/Carrera</a>                                                
											</div>
										</div>
									</div>
								</form>
						<br />
                        <br />                        
                            </div>
        </div>                            
      <div id="div_campana" class="hide">                            
              <div class="portlet-body form">
								<form role="form">
									<div class="form-body">
                                    <div class="row text-center">
										<div class="col-md-4 col-md-push-4 form-group form-md-line-input has-info ">
											<select class="form-control" id="form_control_1">
												<option value=""></option>
												<option value="">Option 1</option>
												<option value="">Option 2</option>
												<option value="">Option 3</option>
												<option value="">Option 4</option>
											</select>
											<label for="form_control_1"><strong>Campa&ntilde;a</strong></label>
										</div>
						             </div>
                                     <div class="row text-center">
										<div class="col-md-4 col-md-push-4 form-group form-md-line-input has-info ">
											<select class="form-control" id="form_control_1">
												<option value=""></option>
												<option value="">Option 1</option>
												<option value="">Option 2</option>
												<option value="">Option 3</option>
												<option value="">Option 4</option>
											</select>
											<label for="form_control_1"><strong>Carrera</strong></label>
										</div>
						             </div>
                                     <div class="row text-center">
										<div class="col-md-4 col-md-push-4 form-group form-md-line-input has-info ">
											<select class="form-control" id="form_control_1">
												<option value=""></option>
												<option value="">Option 1</option>
												<option value="">Option 2</option>
												<option value="">Option 3</option>
												<option value="">Option 4</option>
											</select>
											<label for="form_control_1"><strong>Jornada</strong></label>
										</div>
						             </div>                                                                          
									<div class="form-actions noborder text-center">
										<a onclick="reset()" class="btn default">Gestionar Otro RUT</a>
                                        <button type="button" class="btn blue">Ingresar Oportunidad</button>										
									</div>
								</form>
							</div>
                </div>
                            
                            
              	</div>              
                            
                          	</div>  
                            
                         	</div>                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
						</div>
                                      

       	</div>                     
<script type="text/javascript" src="<?php echo $this->basePath()?>/metronic/theme/assets/global/plugins/jquery.min.js" ></script>                                                                                            
<script>
$(document).ready(function() {       
   UIToastr.init();
});
function reset()
{
   $('#div_form').addClass('hide'); 
   $('#div_campana').addClass('hide'); 
   $('#form_prospecto').trigger("reset");
}
function mostrarpaso2()
{
    $('#div_campana').removeClass('hide');
}

$("#busca_rut").click(function(){    
postData = {'rut' : $('#nueva_rut').val()}
    $.ajax(
    {
        url : '<?php echo $this->basePath()."/operador/oportunidad/buscarut"?>',
        type: "POST",
        data : postData,
        dataType : 'json',
        success : function(response) {
            $('#div_form').removeClass('hide');
            if(response.existe=="si"){
                $("#nueva_nombre").val(response.prospecto[0]['NOMBRES']);
                $("#nueva_apellidop").val(response.prospecto[0]['AP_PATERNO']);
                $("#nueva_apellidom").val(response.prospecto[0]['AP_MATERNO']);
                $("#nueva_estado").val(response.prospecto[0]['ESTADO']);
                $("#nueva_correo").val(response.detalle[0]['CORREO']);
                $("#nueva_tel").val(response.detalle[0]['TELEFONO']);
                $("#nueva_celu").val(response.detalle[0]['CELULAR']);
                $("#nueva_direc").val(response.detalle[0]['DIRECCION']);
                $("#nueva_establec").val(response.detalle[0]['EMPRESA_ESTABLEC']);
                $("#nueva_bodytable").html(response.tabla);
            }
            else{
             //   Command: toastr[success]("No existe prospecto");
                
             $("#alertok").html('<span class="alert alert-success"> '+response.desc+'</span>');                   
            }                                  
        },
        error: function(jqXHR, textStatus, errorThrown) 
        {            
            alert("error"); 
        }
    });
});
$("#form_prospecto").submit(function(e)
{
    var postData = $(this).serializeArray();
    var formURL = $(this).attr("action");
    $.ajax(
    {
        url : formURL,
        type: "POST",
        data : postData,
        dataType : 'json',
        success : function(response) {
                    if(response.status!="ok"){
                        $("#alertnok").html('<span class="alert alert-danger">'+response.descripcion+'</span>'); 
                    }else{
                        $("#alertok").html('<span class="alert alert-success">'+response.descripcion+'</span>');    
                    }
        },
        error: function(jqXHR, textStatus, errorThrown) 
        {
            $("#alertnok").html('<span class="alert alert-success">Error en el env&iacute;o de datos al servidor</span>');      
        }
    });
    e.preventDefault(); //STOP default action    
});

</script>                            